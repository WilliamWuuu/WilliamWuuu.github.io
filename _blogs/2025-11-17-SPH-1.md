---
layout: blog
title: 'Smoothed-Particle Hydrodynamics'
date: 2025-11-17
permalink: /posts/2025/11/SPH-1/
tags:
  - Physics Simulation
---

# Smoothed-Particle Hydrodynamics

## Basic Ideas
Smoothed Particle Hydrodynamics (SPH) is a Lagrangian, mesh-free particle method. Its core idea is to discretize a continuous fluid medium into a set of particles that carry physical attributes (such as mass, density, velocity, pressure, etc.), and approximate the governing equations of fluid motion—such as the Navier–Stokes equations—through interactions among these particles. Unlike traditional grid-based Eulerian methods (e.g., finite difference or finite volume methods), SPH does not rely on a fixed computational mesh. Instead, it simulates the evolution of the entire fluid by tracking the motion of each fluid particle. This unique Lagrangian nature makes SPH particularly suitable for problems involving complex geometric boundaries, free surfaces, large deformations, and multiphase flows.

### Why Particle System?
SPH adopts a particle system as its computational framework mainly because particle discretization offers distinctive advantages for describing fluid motion.

In SPH, each particle carries physical quantities including mass, position, velocity, density, and pressure, and updates its state by interacting with its neighboring particles through a kernel function. A particle’s density is computed as a weighted sum of neighbor masses, while its acceleration is determined by pressure gradients, viscous forces, and external forces.

Since particles move with the fluid, SPH inherently captures convection, avoiding the numerical diffusion and instability commonly encountered when discretizing the convective term in Eulerian methods. This simplifies equation solving and improves stability and accuracy.

Boundary conditions can be naturally imposed using “boundary particles,” which significantly reduces the overhead of mesh generation and adaptation, providing high flexibility for handling complex geometries and dynamic boundaries.

SPH is especially good at simulating free-surface flows such as waves or splashing droplets. The free surface emerges naturally from the distribution of surface particles without additional treatment, enabling the method to naturally capture complex interface dynamics like breaking or merging.

## Kernel Function: From Continuous to Discrete
Kernel functions smooth or interpolate discrete particle information into continuous space. Their choice and properties directly affect the accuracy, stability, and computational efficiency of the SPH method.

### Dirac Delta Function
A core concept in SPH is approximating continuous fields (such as density or velocity) using discrete particles. A kernel function measures how much a particle at \(x_i\) contributes to the field value at a point \(x\). This influence decreases with distance \(r\), controlled by a “smoothing length” \(h\).

Mathematically, SPH is based on approximating the Dirac delta function. The Dirac delta \(\delta(x - x')\) is a generalized function that is infinite when \(x = x'\), zero elsewhere, and integrates to 1. Any continuous function \(f(x)\) can be expressed through convolution with the delta function:
\[
f(x) = \int f(x') \delta(x - x') \,\mathrm{d}x'.
\]

In SPH, a kernel function \(W_h(\mathbf{x} - \mathbf{x}')\) is used to approximate \(\delta\), so we expect:
\[
W(\mathbf{0}) = 1,\quad W(\infty) = 0,\quad W(r)\downarrow \text{ as } r\uparrow,\quad \int W = 1.
\]

Thus, the basic SPH formula becomes:
\[
\begin{align}
f(x)
&= \int f(x') \delta(x - x') \,\mathrm{d}x' \\
&= \int f(x') W_h(x - x')\,\mathrm{d}x' + o(h) \\
&\approx \int f(x') W_h(x - x') \,\mathrm{d}x'. \tag{1}
\end{align}
\]
Here, the approximation error is \(O(h^2)\).

### Calculus on Particle Interpolation
In a discrete particle system, the continuous fluid is replaced by \(N\) particles. Each particle \(i\) has a position \(x_i\), mass \(m_i\), and local density \(\rho_i\). SPH expresses a continuous field function \(f(\mathbf{x})\) as a weighted sum of particle properties.

Starting from the continuous interpolation:
\[
\begin{align}
f(\mathbf{x})
&\approx \int f(x') W_h(x - x') \,\mathrm{d}x' \\
&= \int \frac{f(\mathbf{x}')}{\rho(\mathbf{x}')} W_h(\mathbf{x} - \mathbf{x}') (\rho(\mathbf{x}')\,\mathrm{d}\mathbf{x}'),
\end{align}
\]
where the mass element \(\rho(x')\,\mathrm{d}x'\) is replaced by the particle mass \(m_i\), giving:
\[
f(\mathbf{x}) \approx \sum_i \frac{f(\mathbf{x}_i)}{\rho_i} W_h(\mathbf{x} - \mathbf{x}_i) m_i. \tag{1}
\]

#### Gradient
Using the interchangeability of integral and differential operators:
\[
\begin{align}
\nabla f(\mathbf{x})
&\approx \nabla\left[\int f(\mathbf{x}') W_h(\mathbf{x} - \mathbf{x}')\,\mathrm{d}\mathbf{x}'\right] \\
&= \int f(\mathbf{x}') \nabla_{\mathbf{x}} W_h(\mathbf{x} - \mathbf{x}')\,\mathrm{d}\mathbf{x}' \\
&\approx \sum_i \frac{f(\mathbf{x}_i)}{\rho_i} \nabla W_h(\mathbf{x} - \mathbf{x}_i) m_i. \tag{2}
\end{align}
\]

#### Divergence
For a vector field \(\mathbf{F}(\mathbf{x})\), consider:
\[
\begin{align}
\nabla_{\mathbf{x}} \cdot [\mathbf{F}(\mathbf{x}') W_h(\mathbf{x} - \mathbf{x}')]
&= \nabla_{\mathbf{x}} W_h(\mathbf{x} - \mathbf{x}') \cdot \mathbf{F}(\mathbf{x}') 
+ \underbrace{W_h(\mathbf{x} - \mathbf{x}') \nabla_{\mathbf{x}} \cdot \mathbf{F}(\mathbf{x}')}_{\text{vanish}} \\
&= \nabla_{\mathbf{x}} W_h(\mathbf{x} - \mathbf{x}') \cdot \mathbf{F}(\mathbf{x}').
\end{align}
\]

Thus,
\[
\begin{align}
\nabla\cdot\mathbf{F}(\mathbf{x})
&\approx \int \nabla W_h(\mathbf{x} - \mathbf{x}') \cdot \mathbf{F}(\mathbf{x}')\,\mathrm{d}\mathbf{x}' \\
&\approx \sum_i \frac{\mathbf{F}(\mathbf{x}_i)}{\rho_i} \cdot \nabla W_h(\mathbf{x} - \mathbf{x}_i) m_i. \tag{3}
\end{align}
\]

#### Curl
Similarly, for the curl:
\[
\begin{align}
\nabla_{\mathbf{x}} \times [\mathbf{F}(\mathbf{x}') W_h(\mathbf{x} - \mathbf{x}')]
&= \nabla_{\mathbf{x}} W_h(\mathbf{x} - \mathbf{x}') \times \mathbf{F}(\mathbf{x}')
+ \underbrace{W_h(\mathbf{x} - \mathbf{x}') \nabla_{\mathbf{x}} \times \mathbf{F}(\mathbf{x}')}_{\text{vanish}} \\
&= \nabla_{\mathbf{x}} W_h(\mathbf{x} - \mathbf{x}') \times \mathbf{F}(\mathbf{x}').
\end{align}
\]

Thus,
\[
\begin{align}
\nabla\times\mathbf{F}(\mathbf{x})
&\approx \int \nabla W_h(\mathbf{x} - \mathbf{x}') \times \mathbf{F}(\mathbf{x}')\,\mathrm{d}\mathbf{x}' \\
&\approx \sum_i \frac{\mathbf{F}(\mathbf{x}_i)}{\rho_i} \times \nabla W_h(\mathbf{x} - \mathbf{x}_i) m_i. \tag{4}
\end{align}
\]

### Implicit Estimation
For gradient estimation, the non-uniform particle distribution leads to a non-zero value of
\[
\sum_i \left(\frac{m_i}{\rho_i}\right) \nabla_x W_h(x - x_i),
\]
which introduces a spurious ghost force, causing an \(O(h^2)\) error even when approximating constant functions.

A better approach is to couple \(f\) and \(\rho\), yielding an implicit estimate. Consider:
\[
\nabla(f\rho^n) = n f \rho^{n-1} \nabla\rho + \rho^n \nabla f \quad\Rightarrow\quad \nabla f = \rho^{-n}[\nabla(f\rho^n) - n f\rho^{n-1}\nabla\rho].
\]

Substituting into Eq.(1) gives:
\[
\nabla f(\mathbf{x}) \approx \rho^{-n}(\mathbf{x})
\sum_i m_i \left[f(\mathbf{x}_i)\rho(\mathbf{x}_i)^{\,n-1} - n f(\mathbf{x})\rho(\mathbf{x})^{n-1}\right]
\nabla W_h(\mathbf{x} - \mathbf{x}_i). \tag{5}
\]

For \(n = \pm 1\), the gradient coefficients have symmetric or antisymmetric forms, which help preserve conservation laws:
\[
\begin{align}
n &= 1, & \nabla f &= \rho^{-1} \sum_i m_i (f - f_i)\nabla W_h \tag{6} \\
n &= -1,& \nabla f &= \rho \sum_i m_i \left(\frac{f}{\rho^2} + \frac{f_i}{\rho_i^2}\right)\nabla W_h. \tag{7}
\end{align}
\]

Similarly, for divergence:
\[
\begin{align}
n &= 1, & \nabla\cdot\mathbf{F} &= \rho^{-1} \sum_i m_i (\mathbf{F} - \mathbf{F}_i)\cdot \nabla W_h \tag{8} \\
n &= -1,& \nabla\cdot\mathbf{F} &= \rho \sum_i m_i \left(\frac{\mathbf{F}}{\rho^2} + \frac{\mathbf{F}_i}{\rho_i^2}\right)\cdot\nabla W_h. \tag{9}
\end{align}
\]
